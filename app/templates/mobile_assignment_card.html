{% macro render_assignment_card(assignment) %}
<div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm assignment-{{ assignment_statuses[assignment.id] }}" data-assignment-id="{{ assignment.id }}">
    <!-- First Line: Complete Button + Assignment Name + Three Dots -->
    <div class="flex justify-between items-center mb-2">
        <div class="flex items-center flex-1">
            <input type="checkbox" 
                   class="completed-checkbox w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 focus:ring-2 mr-3 flex-shrink-0" 
                   data-assignment-id="{{ assignment.id }}"
                   {% if assignment.completed %}checked{% endif %}>
            <h4 class="font-semibold text-gray-900 flex-1">
                <span class="editable-field cursor-pointer hover:bg-gray-100 px-1 py-1 rounded" 
                      data-field="name" 
                      data-assignment-id="{{ assignment.id }}"
                      title="Click to edit assignment name">{{ assignment.name }}</span>
            </h4>
        </div>
        <!-- Mobile Actions Dropdown -->
        <div class="relative flex-shrink-0">
            <button type="button" class="text-gray-500 hover:text-gray-700 p-1 assignment-actions-btn" 
                    data-assignment-id="{{ assignment.id }}"
                    title="Assignment actions">
                <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="assignment-actions-menu absolute right-0 mt-1 w-36 bg-white border border-gray-200 rounded-md shadow-lg z-10 hidden">
                <div class="py-1">
                    <button type="button" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center edit-grade-btn"
                            data-assignment-id="{{ assignment.id }}"
                            data-assignment-name="{{ assignment.name }}"
                            data-current-score="{{ assignment.score or '' }}"
                            data-max-score="{{ assignment.max_score }}">
                        <i class="fas fa-edit mr-2 text-yellow-500"></i>Edit Grade
                    </button>
                    <form action="{{ url_for('main.delete_assignment', assignment_id=assignment.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this assignment?');" class="block">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">
                            <i class="fas fa-trash-alt mr-2 text-red-500"></i>Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Second Line: Date + Score/Max Score + Percentage -->
    <div class="flex justify-between items-center text-sm">
        <div class="text-gray-700">
            <span class="editable-field cursor-pointer hover:bg-gray-100 px-1 py-1 rounded" 
                  data-field="due_date" 
                  data-assignment-id="{{ assignment.id }}"
                  title="Click to edit due date">{{ assignment.due_date.strftime('%a %m/%d') if assignment.due_date else 'No date' }}</span>
            {% if assignment.due_date %}
                <span class="text-xs text-gray-500 block">{{ assignment.due_date.strftime('%-I:%M %p') if assignment.due_date else '' }}</span>
            {% endif %}
        </div>
        <div class="text-gray-700">
            {% if assignment.score is not none %}
                <span class="editable-field cursor-pointer hover:bg-gray-100 px-1 py-1 rounded" 
                      data-field="score" 
                      data-assignment-id="{{ assignment.id }}"
                      title="Click to edit score">{{ assignment.score }}</span>
                <span class="text-gray-400">/</span>
                <span class="editable-field cursor-pointer hover:bg-gray-100 px-1 py-1 rounded" 
                      data-field="max_score" 
                      data-assignment-id="{{ assignment.id }}"
                      title="Click to edit max score">{{ assignment.max_score }}</span>
            {% else %}
                <span class="text-gray-400">—/—</span>
                <span class="editable-field cursor-pointer hover:bg-gray-100 px-1 py-1 rounded" 
                      data-field="max_score" 
                      data-assignment-id="{{ assignment.id }}"
                      title="Click to edit max score">{{ assignment.max_score }}</span>
            {% endif %}
        </div>
        <div class="text-gray-700">
            {% if assignment.score is not none %}
                <span class="font-semibold {% if assignment.percentage >= 90 %}text-green-600{% elif assignment.percentage >= 80 %}text-blue-600{% elif assignment.percentage >= 70 %}text-yellow-600{% else %}text-red-600{% endif %}">
                    {{ assignment.percentage|round(1) }}%
                </span>
            {% else %}
                <span class="text-gray-400">—</span>
            {% endif %}
        </div>
    </div>
    
    <!-- Third Line: Category (if applicable) -->
    {% if is_weighted or course.is_category %}
    <div class="text-sm text-gray-700 mt-2">
        {% if assignment.category %}
            Category: <span class="font-medium">{{ assignment.category.name }}</span>
        {% else %}
            <span class="text-gray-400">Uncategorized</span>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endmacro %}